****# 섹션.6 인증 처리하기


## 회원가입 구현하기

![](https://github.com/dididiri1/TIL/blob/main/React/v2/images/06_01.png?raw=true)

Confirm Email 버튼이 보이지 않나요?
Supabase의 잦은 업데이트로 인해 특정 버튼의 위치가 변경될 수 있습니다.
2025년 10월 15일 기준으로 Confirm Email 버튼은 아래의 위치에 있으니 확인 부탁드립니다.
"Authentication 페이지 > Sign In / Provider 섹션 > Users Signups 섹션"

![](https://github.com/dididiri1/TIL/blob/main/React/v2/images/06_02.png?raw=true)


### sign-up-page.ts
```
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { useSignUp } from "@/hooks/mutations/use-sign-up";
import { useState } from "react";
import { Link } from "react-router";

export default function SignUpPage() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");

  const { mutate: signUp } = useSignUp();

  const handleSignupClick = () => {
    if (email.trim() === "") return;
    if (password.trim() === "") return;

    signUp({
      email,
      password,
    });
  };

  return (
    <div className="flex flex-col gap-8">
      <div className="text-xl font-bold">회원가입</div>
      <div className="flex flex-col gap-2">
        <Input
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          type="email"
          placeholder="example@abc.com"
          className="py-6"
        />
        <Input
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          className="py-6"
          type="password"
          placeholder="password"
        />
      </div>
      <div>
        <Button onClick={handleSignupClick} className="w-full">
          회원가입
        </Button>
      </div>
      <div>
        <Link className="text-muted-foreground hover:underline" to={"/sign-in"}>
          이미 계정이 있다면? 로그인
        </Link>
      </div>
    </div>
  );
}
```

### auth.ts
```
import supabase from "@/lib/supabase";

export async function signUp({
  email,
  password,
}: {
  email: string;
  password: string;
}) {
  const { data, error } = await supabase.auth.signUp({
    email,
    password,
  });

  if (error) throw error;

  return data;
}
```

### auth.ts hook 만들기
```
import { signUp } from "@/api/auth";
import { useMutation } from "@tanstack/react-query";

export function useSignUp() {
  return useMutation({
    mutationFn: signUp,
  });
}
```

![](https://github.com/dididiri1/TIL/blob/main/React/v2/images/06_03.png?raw=true)


## 소셜 로그인 구현하기

![](https://github.com/dididiri1/TIL/blob/main/React/v2/images/06_04.png?raw=true)

Clinet Id 와 Cluent Secret 이 두 가지 값은 Supabase 서버가 Githun 서버와
통신을 하기 위해 인증 정보이다.

![](https://github.com/dididiri1/TIL/blob/main/React/v2/images/06_05.png?raw=true)

### GitHub 로그인
- Setting -> Developer Settings -> OAuth 클릭
- 생성 후 Client ID, Client secrets 복사해서 Supabase에 입력
- ![](https://github.com/dididiri1/TIL/blob/main/React/v2/images/06_06.png?raw=true)

### GitHun 소셜 로그인을 위한 Supabase 설정 완료
- ![](https://github.com/dididiri1/TIL/blob/main/React/v2/images/06_07.png?raw=true)

```
import { signInWithOAuth } from "@/api/auth";
import { useMutation } from "@tanstack/react-query";

export function useSignInWithOAuth() {
  return useMutation({
    mutationFn: signInWithOAuth,
  });
}
```
```
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { useSignInWithPassword } from "@/hooks/mutations/use-sign-in-with-password";
import { useState } from "react";
import { Link } from "react-router";
import githubLogo from "@/assets/github-mark.svg";
import { useSignInWithOAuth } from "@/hooks/use-sign-in-with-oauth";

export default function SignInPage() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");

  const { mutate: signInWithPassword } = useSignInWithPassword();
  const { mutate: signInWithOAuth } = useSignInWithOAuth();

  const handleSignInWithPasswordClick = () => {
    if (email.trim() === "") return;
    if (password.trim() === "") return;

    signInWithPassword({
      email,
      password,
    });
  };

  const handleSignInWithGiHubClick = () => {
    signInWithOAuth("github");
  };

  return (
    <div className="flex flex-col gap-8">
      <div className="text-xl font-bold">로그인</div>
      <div className="flex flex-col gap-2">
        <Input
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          type="email"
          placeholder="example@abc.com"
          className="py-6"
        />
        <Input
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          className="py-6"
          type="password"
          placeholder="password"
        />
      </div>
      <div className="flex flex-col gap-2">
        <Button onClick={handleSignInWithPasswordClick} className="w-full">
          로그인
        </Button>
        <Button
          onClick={handleSignInWithGiHubClick}
          className="w-full"
          variant={"outline"}
        >
          <img src={githubLogo} className="h-4 w-4"></img>
          GitHub 계정으로 로그인
        </Button>
      </div>
      <div>
        <Link className="text-muted-foreground hover:underline" to={"/sign-up"}>
          계정이 없으시다면? 회원가입
        </Link>
      </div>
    </div>
  );
}
```


## 라우트 가드 구현하기

1. 개념 및 동작 원리
   라우트 가드는 사용자의 인증 상태(session)에 따라 특정 페이지에 대한 접근 권한을 제어하는 문지기 역할을 합니다.
- <Outlet />: 권한 확인 통과 시, 하위 자식 컴포넌트(페이지)를 렌더링하는 슬롯입니다.
- <Navigate />: 권한이 없을 경우 사용자를 지정된 경로로 강제 이동(리다이렉트)시킵니다.
```
import { Navigate, Route, Routes } from "react-router";
import SignInPage from "./pages/sign-in-page";
import SignUpPage from "./pages/sign-up-page";
import ForgetPasswordPage from "./pages/forget-password-page";
import IndexPage from "./pages/index-page";
import PostDetailPage from "./pages/post-detail-page";
import ProfileDetailPage from "./pages/profile-detail-page";
import ResetPasswordPage from "./pages/reset-password-page";
import GlobalLayout from "./components/layout/global-layout";
import GuestOlnyLayout from "./components/layout/guest-only-layout";
import { MemberOnlyLayout } from "./components/layout/member-only-layout";

export default function RoteRoute() {
  return (
    <Routes>
      <Route element={<GlobalLayout />}>
        <Route element={<GuestOlnyLayout />}>
          <Route path="/sign-in" element={<SignInPage />} />
          <Route path="/sign-up" element={<SignUpPage />} />
          <Route path="/forget-password" element={<ForgetPasswordPage />} />
        </Route>
        <Route element={<MemberOnlyLayout />}>
          <Route path="/" element={<IndexPage />} />
          <Route path="/post/:postId" element={<PostDetailPage />} />
          <Route path="/profile/:userId" element={<ProfileDetailPage />} />
          <Route path="/reset-password" element={<ResetPasswordPage />} />
        </Route>
        <Route path="*" element={<Navigate to={"/"} />} />
      </Route>
    </Routes>
  );
}
```

```
import { useSession } from "@/store/session";
import { Navigate, Outlet } from "react-router";

export default function GuestOlnyLayout() {
  const session = useSession();
  if (session) return <Navigate to={"/"} replace={true} />;

  return <Outlet />;
}
```

```
import { useSession } from "@/store/session";
import { Navigate, Outlet } from "react-router";

export function MemberOnlyLayout() {
  const session = useSession();
  if (!session) return <Navigate to={"sign-in"} replace={true} />;

  return <Outlet />;
}
```